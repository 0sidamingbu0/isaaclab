# ğŸ” è§‚æµ‹è¾“å…¥ä¸æ¨¡å‹è¾“å‡ºé¡ºåºéªŒè¯æŠ¥å‘Š

## ğŸ“‹ ç›®çš„
éªŒè¯éƒ¨ç½²æ—¶çš„è§‚æµ‹è¾“å…¥å’Œæ¨¡å‹è¾“å‡ºé¡ºåºæ˜¯å¦ä¸è®­ç»ƒæ—¶å®Œå…¨ä¸€è‡´ã€‚

---

## 1ï¸âƒ£ è®­ç»ƒæ—¶çš„å…³èŠ‚é¡ºåºï¼ˆIsaac Labï¼‰

### 1.1 Isaac Lab å†…éƒ¨é¡ºåºï¼ˆå­—æ¯åºï¼‰
æ ¹æ® `check_joint_config.py` è¾“å‡ºï¼š
```python
# Isaac Lab æŒ‰å­—æ¯åºæ’åºåçš„å…³èŠ‚é¡ºåº
[
    "leg_l1_joint",   # 0
    "leg_l2_joint",   # 1
    "leg_l3_joint",   # 2
    "leg_l4_joint",   # 3
    "leg_l5_joint",   # 4
    "leg_r1_joint",   # 5
    "leg_r2_joint",   # 6
    "leg_r3_joint",   # 7
    "leg_r4_joint",   # 8
    "leg_r5_joint",   # 9
    "neck_n1_joint",  # 10
    "neck_n2_joint",  # 11
    "neck_n3_joint",  # 12
    "neck_n4_joint"   # 13
]
```

### 1.2 è®­ç»ƒæ—¶çš„ default_dof_pos
```python
default_dof_pos = [
    0.13, 0.07, 0.2, 0.052, -0.05,      # L1, L2, L3, L4, L5
    -0.13, -0.07, -0.2, -0.052, 0.05,   # R1, R2, R3, R4, R5
    0.0, 0.0, 0.0, 0.0                   # N1, N2, N3, N4
]
```

### 1.3 è®­ç»ƒæ—¶çš„å…³èŠ‚è§’åº¦èŒƒå›´
```python
# è¯·è®­ç»ƒæ–¹ç¡®è®¤ï¼šæ¯ä¸ªå…³èŠ‚åœ¨è®­ç»ƒä¸­çš„å–å€¼èŒƒå›´
# L1: [?, ?]
# L2: [?, ?]
# L3: [?, ?]
# ...
```

---

## 2ï¸âƒ£ éƒ¨ç½²æ—¶çš„å…³èŠ‚é¡ºåºï¼ˆROS2 + Gazeboï¼‰

### 2.1 base.yaml ä¸­çš„å…³èŠ‚é¡ºåº
```yaml
joint_names: [
    "leg_r1_joint",   # 0  <- éƒ¨ç½²ç´¢å¼•
    "leg_r2_joint",   # 1
    "leg_r3_joint",   # 2
    "leg_r4_joint",   # 3
    "leg_r5_joint",   # 4
    "leg_l1_joint",   # 5
    "leg_l2_joint",   # 6
    "leg_l3_joint",   # 7
    "leg_l4_joint",   # 8
    "leg_l5_joint",   # 9
    "neck_n1_joint",  # 10
    "neck_n2_joint",  # 11
    "neck_n3_joint",  # 12
    "neck_n4_joint"   # 13
]
```

### 2.2 å½“å‰ä½¿ç”¨çš„ joint_mapping
```yaml
joint_mapping: [5, 6, 7, 8, 9, 0, 1, 2, 3, 4, 10, 11, 12, 13]
```

**å«ä¹‰**ï¼š
- è®­ç»ƒè¾“å‡ºç´¢å¼• 0 (L1) â†’ éƒ¨ç½²ç´¢å¼• 5 (leg_l1_joint) âœ…
- è®­ç»ƒè¾“å‡ºç´¢å¼• 1 (L2) â†’ éƒ¨ç½²ç´¢å¼• 6 (leg_l2_joint) âœ…
- ...
- è®­ç»ƒè¾“å‡ºç´¢å¼• 5 (R1) â†’ éƒ¨ç½²ç´¢å¼• 0 (leg_r1_joint) âœ…

---

## 3ï¸âƒ£ è§‚æµ‹è¾“å…¥æ•°æ®æµéªŒè¯

### 3.1 è§‚æµ‹æ•°æ®æ„å»ºæµç¨‹
```cpp
// rl_sim.cpp: ä»æœºå™¨äººè¯»å–çŠ¶æ€ï¼ˆå·²ç»è¿‡ joint_mappingï¼‰
this->obs.dof_pos = torch::tensor(this->robot_state.motor_state.q)
                    .narrow(0, 0, this->params.num_of_dofs).unsqueeze(0);

// rl_sdk.cpp: è®¡ç®—ç›¸å¯¹ä½ç½®å¹¶è¾“å…¥æ¨¡å‹
torch::Tensor dof_pos_rel = this->obs.dof_pos - this->params.default_dof_pos;
obs_list.push_back(dof_pos_rel * this->params.dof_pos_scale);
```

### 3.2 å®é™…è§‚æµ‹å€¼ï¼ˆStep 0ï¼Œæœºå™¨äººåœ¨ default_dof_posï¼‰
```
ğŸ“Œ Raw dof_pos (è®­ç»ƒé¡ºåº):
[0.1300, 0.0700, 0.2000, 0.0520, -0.0500,   <- L1-L5
 -0.1300, -0.0700, -0.2000, -0.0520, 0.0500, <- R1-R5
 0.0000, 0.0000, 0.0000, 0.0000]             <- N1-N4

ğŸ“Œ default_dof_pos (è®­ç»ƒé¡ºåº):
[0.1300, 0.0700, 0.2000, 0.0520, -0.0500,   <- L1-L5
 -0.1300, -0.0700, -0.2000, -0.0520, 0.0500, <- R1-R5
 0.0000, 0.0000, 0.0000, 0.0000]             <- N1-N4

ğŸ“Œ dof_pos_rel (è¾“å…¥æ¨¡å‹):
[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]  <- å…¨é›¶ï¼æ­£ç¡®ï¼
```

### 3.3 å®Œæ•´è§‚æµ‹å‘é‡ï¼ˆStep 0ï¼‰
```
Observation [1, 74]:
1. ang_vel_body (3):    [0, 0, 0]
2. gravity_vec (3):     [0, -0, -1]  <- æœºä½“åæ ‡ç³»æŠ•å½±
3. dof_pos (14):        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
4. dof_vel (14):        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
5. joint_torques (14):  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
6. commands (3):        [0, 0, 0]
7. actions (14):        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
8. adaptive_phase (9):  [0, 1, 0, 1, 0, 1, 0.6667, 0, 0.37]
```

---

## 4ï¸âƒ£ æ¨¡å‹è¾“å‡ºéªŒè¯

### 4.1 æ¨¡å‹è¾“å‡ºï¼ˆStep 0ï¼‰
```
ğŸ“¤ Model Raw Output (actions, è®­ç»ƒé¡ºåº):
Left leg  (L1-L5): [-2.0000, 1.4877, -1.7587, -2.0000, 2.0000]
Right leg (R1-R5): [-2.0000, 2.0000, 2.0000, 2.0000, -2.0000]
Neck      (N1-N4): [2.0000, -0.0973, 2.0000, -0.1160]
```

### 4.2 è®¡ç®—ç›®æ ‡ä½ç½®
```
output_dof_pos = default_dof_pos + action * action_scale
action_scale = 0.5 (uniform)

ğŸ¯ Target Joint Positions (è®­ç»ƒé¡ºåº):
Left leg  (L1-L5): [-0.8700, 0.8138, -0.6794, -0.9480, 0.9500]
Right leg (R1-R5): [-1.1300, 0.9300, 0.8000, 0.9480, -0.9500]
Neck      (N1-N4): [1.0000, -0.0487, 1.0000, -0.0580]
```

### 4.3 ä¸ default çš„åå·®
```
Joint  | Default  | Target   | Deviation  | åˆç†æ€§
-------|----------|----------|------------|--------
L1     |  0.13    | -0.87    | -1.00      | â“ æå¤§
L2     |  0.07    |  0.81    |  0.74      | â“ å¾ˆå¤§
L3     |  0.20    | -0.68    | -0.88      | â“ æå¤§
L4     |  0.052   | -0.95    | -1.00      | â“ æå¤§
L5     | -0.05    |  0.95    |  1.00      | â“ æå¤§
R1     | -0.13    | -1.13    | -1.00      | â“ æå¤§
R2     | -0.07    |  0.93    |  1.00      | â“ æå¤§
R3     | -0.20    |  0.80    |  1.00      | â“ æå¤§
R4     | -0.052   |  0.95    |  1.00      | â“ æå¤§
R5     |  0.05    | -0.95    | -1.00      | â“ æå¤§
```

**â— é—®é¢˜**ï¼šæ¨¡å‹åœ¨ Step 0ï¼ˆå®Œç¾åˆå§‹çŠ¶æ€ï¼‰è¾“å‡ºäº†æç«¯åŠ¨ä½œï¼Œå¯¼è‡´æœºå™¨äººç«‹å³å¤±è¡¡ï¼

---

## 5ï¸âƒ£ éœ€è¦è®­ç»ƒæ–¹ç¡®è®¤çš„é—®é¢˜

### â“ é—®é¢˜ 1ï¼šè®­ç»ƒæ—¶çš„åˆå§‹é‡ç½®é€»è¾‘
```python
# è¯·ç¡®è®¤è®­ç»ƒæ—¶æœºå™¨äººé‡ç½®åˆ°ä»€ä¹ˆä½ç½®ï¼Ÿ
# 1. æ˜¯å¦é‡ç½®åˆ° default_dof_pos = [0.13, 0.07, 0.2, 0.052, -0.05, ...]ï¼Ÿ
# 2. è¿˜æ˜¯é‡ç½®åˆ°å…¶ä»–ä½ç½®ï¼Ÿ
# 3. é‡ç½®åç¬¬ä¸€æ­¥ï¼Œæ¨¡å‹åº”è¯¥è¾“å‡ºä»€ä¹ˆåŠ¨ä½œï¼Ÿç»´æŒå§¿æ€ï¼ˆ~0ï¼‰è¿˜æ˜¯ç«‹å³å¼€å§‹è¡Œèµ°ï¼Ÿ
```

### â“ é—®é¢˜ 2ï¼šè§‚æµ‹å€¼çš„ç¬¦å·å’Œå•ä½
```python
# è¯·ç¡®è®¤è®­ç»ƒæ—¶ï¼š
# 1. dof_pos æ˜¯ç›¸å¯¹ä½ç½®ï¼ˆraw - defaultï¼‰è¿˜æ˜¯ç»å¯¹ä½ç½®ï¼Ÿ
# 2. dof_pos_scale = 1.0 æ˜¯å¦æ­£ç¡®ï¼Ÿ
# 3. dof_vel_scale = 0.05 æ˜¯å¦æ­£ç¡®ï¼Ÿ
# 4. gravity_vec çš„å¤„ç†ï¼šæ˜¯ä¸–ç•Œåæ ‡ç³»æŠ•å½±åˆ°æœºä½“åæ ‡ç³»å—ï¼Ÿ
```

### â“ é—®é¢˜ 3ï¼šå…³èŠ‚è§’åº¦çš„æ­£æ–¹å‘å®šä¹‰
```python
# å¯¹äºé•œåƒå…³èŠ‚ï¼ˆL1 vs R1ï¼‰ï¼Œè®­ç»ƒæ—¶å¦‚ä½•å®šä¹‰æ­£æ–¹å‘ï¼Ÿ
# ä¾‹å¦‚ï¼š
# - L1 = +0.13 è¡¨ç¤ºå·¦è…¿æŸä¸ªæ–¹å‘å¼¯æ›²
# - R1 = -0.13 è¡¨ç¤ºå³è…¿é•œåƒæ–¹å‘å¼¯æ›²
# 
# è¿™ä¸ªç¬¦å·çº¦å®šæ˜¯å¦æ­£ç¡®ï¼Ÿèƒ½å¦æä¾›æ¯ä¸ªå…³èŠ‚çš„æ­£æ–¹å‘æè¿°ï¼Ÿ
```

### â“ é—®é¢˜ 4ï¼šåŠ¨ä½œè¾“å‡ºçš„é¢„æœŸèŒƒå›´
```python
# è¯·ç¡®è®¤è®­ç»ƒæ—¶ï¼š
# 1. actions çš„è£å‰ªèŒƒå›´ï¼šclip_actions = [-2, 2] æ˜¯å¦æ­£ç¡®ï¼Ÿ
# 2. åœ¨ default_dof_pos æ—¶ï¼Œæ¨¡å‹é€šå¸¸è¾“å‡ºä»€ä¹ˆåŠ¨ä½œå€¼ï¼Ÿ
#    - æ¥è¿‘ 0ï¼ˆç»´æŒï¼‰
#    - è¿˜æ˜¯ç«‹å³è¾“å‡ºå¤§å¹…åº¦åŠ¨ä½œå¼€å§‹è¡Œèµ°ï¼Ÿ
# 3. action_scale = 0.5 æ˜¯å¦æ­£ç¡®ï¼Ÿ
```

### â“ é—®é¢˜ 5ï¼šadaptive_phase çš„è®¡ç®—
```python
# è¯·ç¡®è®¤ adaptive_phase çš„ 9 ç»´è®¡ç®—æ˜¯å¦ä¸è®­ç»ƒä¸€è‡´ï¼š
# - sin(Ï†), cos(Ï†), sin(2Ï†), cos(2Ï†), sin(4Ï†), cos(4Ï†)  (6ç»´)
# - period_ratio (å½’ä¸€åŒ–)
# - stride_norm (å½’ä¸€åŒ–)
# - clearance_norm (å½’ä¸€åŒ–)
# 
# ç‰¹åˆ«æ˜¯ period_ratio, stride_norm, clearance_norm çš„å½’ä¸€åŒ–æ–¹å¼
```

---

## 6ï¸âƒ£ éªŒè¯æµ‹è¯•æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šé€ç»´åº¦éªŒè¯
è¯·è®­ç»ƒæ–¹æä¾›ä¸€ä¸ª**æ ‡å‡†æµ‹è¯•æ ·æœ¬**ï¼š
```python
# è¾“å…¥ï¼šç‰¹å®šçš„è§‚æµ‹å€¼
test_observation = {
    "ang_vel_body": [0.1, 0.2, 0.3],
    "gravity_vec": [0, 0, -9.81],
    "dof_pos": [0, 0, 0, ...],  # 14ç»´
    "dof_vel": [0, 0, 0, ...],  # 14ç»´
    "joint_torques": [0, 0, ...],  # 14ç»´
    "commands": [0, 0, 0],
    "actions": [0, 0, 0, ...],  # 14ç»´
    "adaptive_phase": [0, 1, 0, 1, 0, 1, 0.67, 0, 0.37]
}

# é¢„æœŸè¾“å‡ºï¼šæ ‡å‡†çš„åŠ¨ä½œå€¼
expected_actions = [?, ?, ?, ...]  # 14ç»´
```

æˆ‘ä»¬ç”¨è¿™ä¸ªæµ‹è¯•æ ·æœ¬åœ¨éƒ¨ç½²ç¯å¢ƒè¿è¡Œï¼Œå¯¹æ¯”è¾“å‡ºæ˜¯å¦ä¸€è‡´ã€‚

### æ–¹æ¡ˆ Bï¼šåå‘éªŒè¯
æˆ‘ä»¬æä¾›éƒ¨ç½²æ—¶çš„å®Œæ•´è§‚æµ‹æ—¥å¿—ï¼ˆå·²åœ¨ä¸Šé¢ï¼‰ï¼Œè¯·è®­ç»ƒæ–¹ï¼š
1. ç”¨ç›¸åŒçš„è§‚æµ‹å€¼åœ¨è®­ç»ƒç¯å¢ƒæµ‹è¯•
2. å¯¹æ¯”æ¨¡å‹è¾“å‡ºæ˜¯å¦ä¸éƒ¨ç½²ä¸€è‡´
3. å¦‚æœä¸ä¸€è‡´ï¼Œå®šä½å·®å¼‚åœ¨å“ªä¸€æ­¥

### æ–¹æ¡ˆ Cï¼šå…³èŠ‚è§’åº¦å½•åƒå¯¹æ¯”
1. è®­ç»ƒæ–¹å½•åˆ¶è®­ç»ƒç¯å¢ƒä¸­æœºå™¨äººæ‰§è¡Œç­–ç•¥çš„è§†é¢‘
2. æ ‡æ³¨å‡ºæ¯ä¸ªæ—¶åˆ»çš„å…³èŠ‚è§’åº¦å€¼
3. æˆ‘ä»¬åœ¨éƒ¨ç½²ç¯å¢ƒå¤ç°ç›¸åŒçš„è§‚æµ‹è¾“å…¥
4. å¯¹æ¯”å…³èŠ‚è§’åº¦æ˜¯å¦ä¸€è‡´

---

## 7ï¸âƒ£ è°ƒè¯•è¾“å‡ºé…ç½®

å½“å‰å·²æ·»åŠ çš„è¯¦ç»†è°ƒè¯•è¾“å‡ºï¼ˆæ¯ 50-100 æ­¥ï¼‰ï¼š

âœ… **è§‚æµ‹è¾“å…¥**ï¼š
- ç»´åº¦æ£€æŸ¥
- å„éƒ¨åˆ†æ•°å€¼èŒƒå›´
- dof_pos çš„ raw / default / relative å€¼
- gravity_vec çš„æ¨¡é•¿æ£€æŸ¥

âœ… **æ¨¡å‹è¾“å‡º**ï¼š
- Actions èŒƒå›´
- Output_dof_pos èŒƒå›´
- å„å…³èŠ‚çš„ default / target / current å¯¹æ¯”
- å…³èŠ‚æ˜ å°„å…³ç³»å±•ç¤º

âœ… **é”™è¯¯æƒ…å†µ**ï¼š
- å½“ actions è¶…å‡º [-2, 2] æ—¶æŠ¥è­¦
- å½“ output_dof_pos åç¦» default è¶…è¿‡ 1.5 rad æ—¶æŠ¥è­¦

---

## 8ï¸âƒ£ æœŸæœ›çš„è®­ç»ƒæ–¹åé¦ˆ

è¯·è®­ç»ƒæ–¹æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **è®­ç»ƒä»£ç ç‰‡æ®µ**ï¼š
   - è§‚æµ‹å€¼æ„å»ºçš„ä»£ç 
   - å…³èŠ‚é¡ºåºå®šä¹‰çš„ä»£ç 
   - é‡ç½®é€»è¾‘çš„ä»£ç 

2. **è®­ç»ƒæ—¥å¿—**ï¼š
   - Episode é‡ç½®æ—¶çš„ dof_pos å€¼
   - å‰ 10 æ­¥çš„ observation å’Œ action å€¼
   - æˆåŠŸè¡Œèµ°æ—¶çš„å…¸å‹ observation å’Œ action å€¼

3. **å…³èŠ‚å®šä¹‰æ–‡æ¡£**ï¼š
   - æ¯ä¸ªå…³èŠ‚çš„æ­£æ–¹å‘è¯´æ˜ï¼ˆæ–‡å­—æˆ–å›¾ç‰‡ï¼‰
   - æ¯ä¸ªå…³èŠ‚çš„å–å€¼èŒƒå›´
   - é•œåƒå…³èŠ‚çš„ç¬¦å·çº¦å®š

4. **æ¨¡å‹æµ‹è¯•**ï¼š
   - ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ Step 0 è§‚æµ‹å€¼æµ‹è¯•æ¨¡å‹
   - è¿”å›æ¨¡å‹è¾“å‡ºçš„ actions å€¼
   - ç¡®è®¤æ˜¯å¦åº”è¯¥è¾“å‡ºæç«¯å€¼

---

## 9ï¸âƒ£ å½“å‰æ€€ç–‘çš„é—®é¢˜ç‚¹

### æ€€ç–‘ç‚¹ 1ï¼šå…³èŠ‚è§’åº¦çš„ç¬¦å·å®šä¹‰ä¸ä¸€è‡´ âš ï¸
- è®­ç»ƒæ—¶ï¼šL1 æ­£æ–¹å‘ = æŸæ–¹å‘ï¼ŒR1 è´Ÿæ–¹å‘ = é•œåƒæ–¹å‘
- éƒ¨ç½²æ—¶ï¼šå¯èƒ½æ­£è´Ÿå·ç†è§£ç›¸åï¼Ÿ

### æ€€ç–‘ç‚¹ 2ï¼šåˆå§‹ä½ç½®ç†è§£ä¸ä¸€è‡´ âš ï¸
- è®­ç»ƒæ—¶ï¼šå¯èƒ½å¹¶ä¸æ˜¯ä» default_dof_pos å¼€å§‹
- éƒ¨ç½²æ—¶ï¼šæˆ‘ä»¬å‡è®¾ä» default_dof_pos å¼€å§‹

### æ€€ç–‘ç‚¹ 3ï¼šè§‚æµ‹å€¼çš„åæ ‡ç³»ä¸ä¸€è‡´ âš ï¸
- gravity_vecï¼šè®­ç»ƒæ—¶å¯èƒ½ç”¨çš„æ˜¯åŸå§‹åŠ é€Ÿåº¦è®¡ï¼Ÿ
- éƒ¨ç½²æ—¶ï¼šæˆ‘ä»¬ç”¨ä¸–ç•Œé‡åŠ›æŠ•å½±åˆ°æœºä½“åæ ‡ç³»

### æ€€ç–‘ç‚¹ 4ï¼šæ¨¡å‹æ–‡ä»¶åŠ è½½é”™è¯¯ âš ï¸
- å¯èƒ½åŠ è½½äº†é”™è¯¯ç‰ˆæœ¬çš„æ¨¡å‹ï¼Ÿ
- å¯èƒ½æ¨¡å‹æ²¡æœ‰æ­£ç¡®ä¿å­˜/å¯¼å‡ºï¼Ÿ

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è®­ç»ƒæ–¹**ï¼šå›ç­”ä¸Šè¿° 5 ä¸ªé—®é¢˜ + æä¾›ç¬¬ 8 èŠ‚è¦æ±‚çš„ä¿¡æ¯
2. **éƒ¨ç½²æ–¹**ï¼šå‡†å¤‡å¥½æµ‹è¯•ç¯å¢ƒï¼Œç­‰å¾…æ ‡å‡†æµ‹è¯•æ ·æœ¬
3. **è”åˆè°ƒè¯•**ï¼šä½¿ç”¨ç›¸åŒçš„è¾“å…¥ï¼Œå¯¹æ¯”ä¸¤è¾¹çš„è¾“å‡º
4. **é€æ­¥æ’æŸ¥**ï¼šä»è§‚æµ‹â†’æ¨¡å‹â†’åŠ¨ä½œâ†’æ§åˆ¶ï¼Œé€ç¯èŠ‚éªŒè¯

---

## ğŸ“Š é™„å½•ï¼šå®Œæ•´çš„ Step 0 è°ƒè¯•æ—¥å¿—

```
[å·²åœ¨ç”¨æˆ·æä¾›çš„æ—¥å¿—ä¸­ï¼ŒåŒ…å« Step 0, 50, 100, ... çš„å®Œæ•´è§‚æµ‹å’ŒåŠ¨ä½œä¿¡æ¯]
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š2025-11-03  
**éƒ¨ç½²ç¯å¢ƒ**ï¼šROS2 Humble + Gazebo + LibTorch  
**è®­ç»ƒç¯å¢ƒ**ï¼šIsaac Lab + PyTorch  
**æ¨¡å‹æ–‡ä»¶**ï¼šmodel_7500.pt (iter 7405, reward +67)
